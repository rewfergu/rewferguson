---
import type { InferGetStaticPropsType } from 'astro';
import Image from '~/components/common/Image.astro';
import Layout from '~/layouts/PageLayout.astro';
import ProjectTags from '~/components/widgets/ProjectTags.astro';
import ProjectImages from '~/components/widgets/ProjectImages.astro';
import YoutubeVideo from '~/components/common/YoutubeVideo.astro';
import { getCollection } from 'astro:content';

export const prerender = true;

export async function getStaticPaths() {
  const blogEntries = await getCollection('words');
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout>
  <section class="py-8 sm:py-16 lg:py-20 mx-auto">
    <article>
      <header class={entry.data.cover ? '' : ''}>
        {
          entry.data.cover && (
            <Image
              src={entry.data.cover.src}
              class="max-w-full lg:max-w-[900px] mx-auto mb-6 sm:rounded-md bg-gray-400 dark:bg-slate-700"
              widths={[400, 900]}
              sizes="(max-width: 900px) 400px, 900px"
              alt={entry.data.cover.alt || ''}
              width={900}
              height={506}
              loading="eager"
              decoding="async"
            />
          )
        }

        <h1 class="px-4 sm:px-6 max-w-3xl mx-auto text-4xl md:text-5xl font-light font-heading uppercase">
          {entry.data.name}
        </h1>
      </header>
      <div
        class="mx-auto px-6 sm:px-6 max-w-3xl prose prose-md lg:prose-xl dark:prose-invert dark:prose-headings:text-slate-300 prose-headings:font-heading prose-headings:font-light prose-a:text-primary dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg mt-8 prose-headings:scroll-mt-[80px]"
      >
        <Content />

        <ProjectTags tags={entry.data.tags} />
        {
          entry.data.video &&
            entry.data.video.map((vid: string) => <YoutubeVideo videoId={vid.split('youtu.be/')[1]} />)
        }
        {entry.data.images && <ProjectImages images={entry.data.images} />}
      </div>
    </article>
  </section>
</Layout>
